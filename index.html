<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google è©¦ç®—è¡¨å–®æ¬„æŠ½ç±¤æ©Ÿ</title>
    <style>
      body {
        font-family: 'Inter', Arial, sans-serif;
        background-image: url('https://chy0205.github.io/1207/003.png'); /* èƒŒæ™¯åœ–ç‰‡ URL */
        background-size: cover;
        background-position: top center;
        background-attachment: fixed;
        background-repeat: no-repeat;
        text-align: center;
        padding: 20px;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      
      /* å°‡éŸ³é »æ’­æ”¾å™¨éš±è— */
      #spinSound, #finishSound {
        display: none; 
      }

      /* æ¨™é¡Œéš±è— */
      h1, h4 {
        color: rgba(0, 0, 0, 0); 
      }

      /* å–®ä¸€è½‰ç›¤å®¹å™¨ï¼Œæ›´åŠ çªå‡º */
      .slot-machine-wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 40px;
        flex-direction: column; 
      }
      
      .single-reel-box {
        width: 90vw; /* å¯¬åº¦éŸ¿æ‡‰å¼ */
        max-width: 400px; /* æœ€å¤§å¯¬åº¦å·²ç¸®å° */
        height: 80px; /* é«˜åº¦å·²ç¸®å° */
        border-radius: 20px;
        font-size: 28px; /* å­—é«”å¤§å°å·²ç¸®å° */
        font-weight: 900; /* è¶…ç´šåŠ ç²— */
        display: flex; 
        align-items: center; 
        justify-content: center; 
        color: #FFFFFF; /* <<<<<< è®Šæ›´ï¼šé è¨­æ–‡å­—é¡è‰²æ”¹ç‚ºç™½è‰² */
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); /* æ›´æ·±çš„é™°å½± */
        background-color: transparent; /* <<<<<< è®Šæ›´ï¼šèƒŒæ™¯é¡è‰²æ”¹ç‚ºé€æ˜ */
        padding: 0 20px; /* èª¿æ•´å…§é‚Šè· */
        box-sizing: border-box; 
        border: none; /* <<<<<< è®Šæ›´ï¼šç§»é™¤é‚Šæ¡† */
        overflow: hidden; 
        transition: box-shadow 0.3s ease, font-size 0.3s ease;
      }
      
      .single-reel-box.spinning {
        color: #FFFF00; /* è½‰å‹•æ™‚æ–‡å­—é¡è‰²è®ŠåŒ–ç‚ºäº®é»ƒè‰² */
        box-shadow: 0 0 40px rgba(255, 255, 0, 0.9); /* è½‰å‹•æ™‚ç™¼å‡ºé»ƒè‰²å…‰æšˆ */
      }
      
      .final-result-text {
          font-size: 40px; /* æœ€çµ‚çµæœå­—é«”å·²ç¸®å° */
          color: #d9534f; /* é†’ç›®ç´…è‰² (ä¿æŒä¸è®Š) */
          font-weight: bold;
      }

      /* æŒ‰éˆ•å®¹å™¨ */
      .button-group {
          margin-top: 30px;
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
          gap: 15px;
      }

      button {
        padding: 15px 30px;
        font-size: 16px;
        font-weight: bold;
        color: white;
        border: none;
        border-radius: 8px; 
        cursor: pointer;
        transition: all 0.3s ease; 
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-transform: uppercase;
      }

      #drawButton {
        background-color: #ff9900;
        box-shadow: 0 4px #e68a00;
        min-width: 150px;
      }
      #drawButton:hover {
        background-color: #e68a00;
        transform: translateY(-2px);
      }
      #drawButton:active {
        box-shadow: 0 2px #e68a00;
        transform: translateY(2px);
      }

      #restartButton {
        background-color: #008080; 
        box-shadow: 0 4px #006666;
        min-width: 150px;
      }
      #restartButton:hover {
        background-color: #006666;
        transform: translateY(-2px);
      }

      button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
      }

      #result {
        margin-top: 30px;
        font-size: 20px; 
        color: #003366; 
        font-weight: bold; 
        min-height: 30px; 
      }

      #result b {
        color: #d9534f;
      }
      #result span {
        font-size: 16px;
        color: #555;
        display: block;
        margin-top: 5px;
      }

      #history {
        margin-top: 40px;
        text-align: left;
        max-width: 400px;
        width: 90%;
        margin-left: auto;
        margin-right: auto;
        background: rgba(255, 255, 255, 0.95); /* ä¿æŒç™½è‰²èƒŒæ™¯è®“ç´€éŒ„å¯è®€ */
        padding: 15px;
        border-radius: 10px;
        border: none; /* <<<<<< è®Šæ›´ï¼šç§»é™¤é‚Šæ¡† */
        min-height: 100px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15); 
        overflow-y: auto; 
        max-height: 250px; 
        color: #333;
        font-size: 16px;
      }

      #history div {
        margin-bottom: 5px;
        border-bottom: 1px dotted #eee; 
        padding-bottom: 3px;
        display: flex;
        justify-content: space-between;
      }
      #history div:last-child {
        border-bottom: none;
      }
      
      .history-title {
          font-size: 18px;
          margin-bottom: 10px;
          display: block;
          font-weight: bold;
          color: #003366;
      }
      
    </style>
  </head>
  <body>
    <!-- éš±è—çš„æ¨™é¡Œ -->
    <h1>1</h1>
    <h1>2</h1>
    <h1>2</h1>
    <h1>2</h1>

    <!-- å–®ä¸€å‹•æ…‹æŠ½çæ¡† -->
    <div class="slot-machine-wrapper">
      <div id="singleReel" class="single-reel-box">-- è¼‰å…¥ä¸­ --</div>
    </div>
    
    <!-- ä½”ä½ç¬¦ -->
    <div style="height: 20px;"></div> 

    <!-- å¯¦éš›éŸ³è¨Šæª”æ¡ˆ URL -->
    <audio id="spinSound" src="https://chy0205.github.io/1207/002.mp3" preload="auto" loop></audio> 
    <audio id="finishSound" src="https://chy0205.github.io/1207/002.mp3" preload="auto"></audio>
    
    <!-- æŒ‰éˆ•ç¾¤çµ„ -->
    <div class="button-group">
        <button id="drawButton" onclick="startDraw()" disabled>è¼‰å…¥æ•¸æ“šä¸­...</button>
        <button id="restartButton" onclick="restartAll()">ğŸ”„ é‡æ–°é–‹å§‹ (é‡ç½®åå–®)</button>
    </div>

    <div id="result">è«‹ç¨å€™ï¼Œæ­£åœ¨å¾ Google è©¦ç®—è¡¨è¼‰å…¥æ•¸æ“š...</div>
    <div id="history"><strong class="history-title">ğŸ¯ å·²æŠ½å–åå–®ï¼š</strong></div>

    <script>
      // =======================================================
      // !! æ•¸æ“šæºï¼šä½¿ç”¨æä¾›çš„å…¬é–‹ç™¼å¸ƒé€£çµï¼Œè½‰æ›ç‚º CSV åŒ¯å‡ºé€£çµã€‚
      const PUBLIC_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQoBcigWHcMcS68OCWVgKkpd0w5TtQk1yqBP5qieowGCtvyfYHiBPSX_yfivLU4nOdCyyAbGa5cDht8/pub?output=csv&gid=0"; 
      // =======================================================

      let initialItems = []; // å¾è©¦ç®—è¡¨è¼‰å…¥çš„åŸå§‹é …ç›®åˆ—è¡¨
      let undrawnItems = []; // å°šæœªè¢«æŠ½å–çš„é …ç›®åˆ—è¡¨
      let drawnHistory = []; // æŠ½å–ç´€éŒ„

      // ç²å–å…ƒç´ 
      const spinSound = document.getElementById('spinSound'); 
      const finishSound = document.getElementById('finishSound'); 
      const singleReel = document.getElementById('singleReel');
      const drawButton = document.getElementById('drawButton');
      const resultDiv = document.getElementById('result');
      const historyDiv = document.getElementById('history');

      /**
       * æ’­æ”¾è½‰å‹•éŸ³æ•ˆã€‚
       */
      function playSpinSound() {
        if (spinSound) {
          spinSound.currentTime = 0; 
          spinSound.play().catch(e => console.log("è½‰å‹•éŸ³é »æ’­æ”¾å¤±æ•—:", e));
        }
      }

      /**
       * åœæ­¢è½‰å‹•éŸ³æ•ˆã€‚
       */
      function stopSpinSound() {
        if (spinSound) {
          spinSound.pause(); 
          spinSound.currentTime = 0; 
        }
      }

      /**
       * æ’­æ”¾çµæŸéŸ³æ•ˆçš„ç‰¹å®šå€æ®µã€‚
       */
      function playFinishSound(startTime, duration) {
        if (finishSound) {
          finishSound.currentTime = startTime; 
          finishSound.play().catch(e => console.log("çµæŸéŸ³é »æ’­æ”¾å¤±æ•—:", e)); 

          setTimeout(() => {
            finishSound.pause();
            finishSound.currentTime = 0; 
          }, duration * 1000); 
        }
      }
      
      /**
       * è¼‰å…¥ä¸¦è§£æ Google Sheets çš„ CSV è³‡æ–™ï¼Œåªè®€å–ç¬¬ä¸€æ¬„ã€‚
       */
      async function loadDataFromSheet() {
        try {
          const url = PUBLIC_CSV_URL.replace(/^http:\/\//i, 'https://');
          const response = await fetch(url);
          if (!response.ok) {
            throw new Error(`HTTP éŒ¯èª¤! ç‹€æ…‹: ${response.status}`);
          }
          const csvText = await response.text();
          
          // è§£æ CSV
          const rows = csvText.split('\n').filter(row => row.trim() !== '');
          
          if (rows.length < 2) {
            resultDiv.innerHTML = 'ğŸš¨ è­¦å‘Šï¼šè©¦ç®—è¡¨å¯èƒ½ç‚ºç©ºæˆ–åªæœ‰æ¨™é¡Œè¡Œã€‚';
            drawButton.disabled = true;
            singleReel.innerText = 'ç„¡æ•¸æ“š';
            return;
          }
          
          // è™•ç†æ•¸æ“šè¡Œ (å‡è¨­ç¬¬ä¸€è¡Œæ˜¯æ¨™é¡Œï¼Œæ•¸æ“šå¾ç¬¬äºŒè¡Œé–‹å§‹)
          // åªè®€å–ç¬¬ä¸€æ¬„ (Column A) ä½œç‚ºæŠ½å–é …ç›®
          
          initialItems = []; // æ¸…ç©ºèˆŠæ•¸æ“š
          
          for (let i = 1; i < rows.length; i++) {
            // ä½¿ç”¨æ­£å‰‡è¡¨é”å¼ä¾†è™•ç†å¯èƒ½çš„é€—è™Ÿå’Œå¼•è™Ÿ
            const columns = rows[i].match(/(".*?"|[^",\s]+)(?=\s*,\s*|\s*$)/g) || [];
            
            // ç¢ºä¿æœ‰ç¬¬ä¸€æ¬„
            if (columns.length === 0) continue; 

            // ç§»é™¤å¼•è™Ÿä¸¦æ¸…ç†ç©ºæ ¼ï¼Œä½œç‚ºæŠ½å–é …ç›®
            const item = columns[0].trim().replace(/"/g, '');

            if (item) {
              initialItems.push(item);
            }
          }
          
          // ç§»é™¤é‡è¤‡é …ä¸¦æ’åº (å¯é¸ï¼Œä½†ä¿æŒæ•¸æ“šæ¸…æ™°)
          initialItems = Array.from(new Set(initialItems)).sort();
          undrawnItems = [...initialItems]; // åˆå§‹åŒ–æœªæŠ½å–åˆ—è¡¨

          if (initialItems.length === 0) {
             resultDiv.innerHTML = 'ğŸš¨ éŒ¯èª¤ï¼šè©¦ç®—è¡¨ä¸­æ‰¾ä¸åˆ°æœ‰æ•ˆçš„æŠ½çæ•¸æ“šï¼è«‹æª¢æŸ¥ Column A æ˜¯å¦æœ‰è³‡æ–™ã€‚';
             singleReel.innerText = 'ç„¡æ•¸æ“š';
             drawButton.disabled = true;
             return;
          }

          // è¼‰å…¥æˆåŠŸ
          drawButton.disabled = false;
          drawButton.innerText = 'é–‹å§‹æŠ½é¸';
          resultDiv.innerHTML = `âœ… æ•¸æ“šè¼‰å…¥æˆåŠŸï¼å…±æœ‰ <b>${initialItems.length}</b> å€‹é …ç›®å¯ä¾›æŠ½å–ã€‚`;
          singleReel.innerText = '-- / --';

        } catch (error) {
          console.error("è¼‰å…¥è©¦ç®—è¡¨æ•¸æ“šå¤±æ•—:", error);
          resultDiv.innerHTML = `ğŸš¨ æ•¸æ“šè¼‰å…¥å¤±æ•—ï¼è«‹æª¢æŸ¥æ‚¨çš„å…¬é–‹ç¶²å€æ˜¯å¦æ­£ç¢ºã€‚éŒ¯èª¤: ${error.message}`;
          singleReel.innerText = 'è¼‰å…¥å¤±æ•—';
          drawButton.disabled = true;
        }
      }
      
      /**
       * æ ¹æ“šç•¶å‰ undrawnItems åˆ—è¡¨ï¼Œç”Ÿæˆä¸€å€‹ç”¨æ–¼å‹•ç•«é¡¯ç¤ºçš„æ»¾å‹•æ¸…å–®ã€‚
       */
      function getSpinDisplayList(currentPool) {
          let displayList = [];
          
          if (currentPool.length === 0) return ["--"];

          // æ»¾å‹•æ¸…å–®åŒ…å«æ‰€æœ‰æœªæŠ½å–çš„é …ç›®ï¼Œé‡è¤‡å¤šæ¬¡ä»¥å»¶é•·å‹•ç•«æ•ˆæœ
          for (let i = 0; i < 50; i++) { 
              const index = Math.floor(Math.random() * currentPool.length);
              displayList.push(currentPool[index]);
          }
          return displayList;
      }

      /**
       * é–‹å§‹æŠ½é¸æµç¨‹ (å–®ä¸€é …ç›®)ã€‚
       */
      function startDraw() {
        if (undrawnItems.length === 0) {
          resultDiv.innerHTML = 'ğŸš¨ æ‰€æœ‰é …ç›®éƒ½æŠ½å®Œäº†ï¼Œè«‹æŒ‰ã€Œé‡æ–°é–‹å§‹ã€æŒ‰éˆ•ï¼';
          drawButton.disabled = true;
          singleReel.classList.remove('spinning');
          stopSpinSound();
          return;
        }

        drawButton.disabled = true;
        resultDiv.innerHTML = `æ­£åœ¨æŠ½å–... (å‰©é¤˜ ${undrawnItems.length} å€‹é …ç›®)`;
        singleReel.innerHTML = 'æŠ½å–ä¸­...';
        
        // 1. ç¢ºå®šæœ€çµ‚çš„æŠ½å–çµæœ
        const finalItemIndex = Math.floor(Math.random() * undrawnItems.length);
        const finalItem = undrawnItems[finalItemIndex];
        
        // 2. é–‹å§‹éŸ³æ•ˆèˆ‡å‹•ç•«
        stopSpinSound();
        if (finishSound) {
          finishSound.pause();
          finishSound.currentTime = 0;
        }
        playSpinSound(); 
        singleReel.classList.add('spinning');
        
        let spinDuration = 3000 + Math.random() * 1500; 
        let start = null; 
        
        const displayList = getSpinDisplayList(undrawnItems);
        const len = displayList.length;

        function animate(time) {
          if (!start) start = time;
          const progress = time - start;
          
          if (len > 0) {
              // æ§åˆ¶æ»¾å‹•é€Ÿåº¦
              const i = Math.floor(progress / 70) % len; 
              singleReel.innerHTML = displayList[i];
          }

          if (progress < spinDuration) {
            requestAnimationFrame(animate); 
          } else {
            // 3. å‹•ç•«çµæŸï¼Œé¡¯ç¤ºæœ€çµ‚çµæœ
            
            // å¾æœªæŠ½å–åˆ—è¡¨ä¸­ç§»é™¤
            undrawnItems.splice(finalItemIndex, 1);
            
            // åŠ å…¥æ­·å²ç´€éŒ„
            drawnHistory.push(finalItem);
            
            const finalDisplay = `<span class="final-result-text">${finalItem}</span>`;
            singleReel.innerHTML = finalDisplay; 

            // åœ¨æ­·å²è¨˜éŒ„ä¸­é¡¯ç¤º
            const drawnCount = drawnHistory.length;
            historyDiv.innerHTML += `
              <div><span>${drawnCount}.</span> <span><b>${finalItem}</b></span></div>
            `;
            historyDiv.scrollTop = historyDiv.scrollHeight;

            resultDiv.innerHTML = `ğŸ‰ æ­å–œï¼æŠ½å‡ºï¼š<b>${finalItem}</b> <span>(å‰©é¤˜ ${undrawnItems.length} å€‹é …ç›®æœªæŠ½å–)</span>`;
            
            singleReel.classList.remove('spinning');
            
            // æª¢æŸ¥æ˜¯å¦å·²æŠ½å®Œ
            if (undrawnItems.length > 0) {
                drawButton.disabled = false; 
            } else {
                drawButton.disabled = true;
                resultDiv.innerHTML = `ğŸ‰ æ­å–œï¼æ‰€æœ‰ <b>${drawnCount}</b> å€‹é …ç›®å·²å…¨éƒ¨æŠ½å–å®Œç•¢ï¼`;
            }

            stopSpinSound(); 
            playFinishSound(9, 2); 
          }
        }

        requestAnimationFrame(animate); 
      }

      /**
       * é‡ç½®æ‰€æœ‰æŠ½çè³‡æ–™ï¼Œé‡æ–°é–‹å§‹ã€‚
       */
      function restartAll() {
        undrawnItems = [...initialItems]; // æ¢å¾©æœªæŠ½å–åˆ—è¡¨
        drawnHistory = []; 
        singleReel.innerHTML = '-- / --';
        resultDiv.innerHTML = `æ‰€æœ‰è³‡æ–™å·²é‡ç½®ï¼å…±æœ‰ <b>${initialItems.length}</b> å€‹é …ç›®ã€‚è«‹é‡æ–°é–‹å§‹æŠ½é¸ï¼`;
        historyDiv.innerHTML = '<strong class="history-title">ğŸ¯ å·²æŠ½å–åå–®ï¼š</strong>';
        drawButton.disabled = initialItems.length === 0;
        drawButton.innerText = 'é–‹å§‹æŠ½é¸';
        
        stopSpinSound();
        if (finishSound) {
          finishSound.pause();
          finishSound.currentTime = 0;
        }
        
        singleReel.classList.remove('spinning');
      }

      // ç¶²é è¼‰å…¥æ™‚è‡ªå‹•åŸ·è¡Œ
      window.onload = loadDataFromSheet;
    </script>
  </body>
</html>
